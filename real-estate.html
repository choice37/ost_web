<!DOCTYPE HTML>
<!--
	Strongly Typed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>아파트 가격지수 분석기 - Strongly Typed by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<style>
			/* 커스텀 스타일 */
			.analysis-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}
			
			.controls-section {
				background: #f8f9fa;
				padding: 25px;
				border-radius: 8px;
				margin-bottom: 30px;
				border: 1px solid #e9ecef;
				box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			}
			
			.controls-header {
				text-align: center;
				margin-bottom: 25px;
				border-bottom: 2px solid #e9ecef;
				padding-bottom: 15px;
			}
			
			.controls-header h3 {
				margin: 0;
				color: #333;
				font-size: 18px;
				font-weight: bold;
			}
			
			.controls-grid {
				display: grid;
				grid-template-columns: 200px 1fr 200px;
				gap: 25px;
				align-items: start;
			}
			
			.control-group {
				display: flex;
				flex-direction: column;
				min-height: 80px;
			}
			
			.control-group label {
				font-weight: bold;
				margin-bottom: 10px;
				color: #333;
				font-size: 14px;
			}
			
			.control-group select, .control-group button {
				padding: 12px;
				border: 2px solid #ddd;
				border-radius: 6px;
				font-size: 14px;
				transition: all 0.3s ease;
			}
			
			.control-group select:focus {
				border-color: #007bff;
				outline: none;
				box-shadow: 0 0 0 3px rgba(0,123,255,0.25);
			}
			
			.control-group button {
				background: #007bff;
				color: white;
				border: none;
				cursor: pointer;
				font-weight: bold;
				align-self: end;
				margin-top: auto;
			}
			
			.control-group button:hover {
				background: #0056b3;
				transform: translateY(-1px);
				box-shadow: 0 4px 8px rgba(0,0,0,0.2);
			}
			
			/* 체크박스 그리드 스타일 */
			.checkbox-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
				gap: 8px;
				max-height: 250px;
				overflow-y: auto;
				padding: 15px;
				border: 2px solid #ddd;
				border-radius: 6px;
				background: white;
				box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
			}
			
			.checkbox-item {
				display: flex;
				align-items: center;
				padding: 10px;
				border-radius: 4px;
				transition: all 0.2s ease;
				border: 1px solid transparent;
			}
			
			.checkbox-item:hover {
				background-color: #f0f8ff;
				border-color: #007bff;
			}
			
			.checkbox-item input[type="checkbox"] {
				margin-right: 10px;
				transform: scale(1.3);
				cursor: pointer;
				accent-color: #007bff;
			}
			
			.checkbox-item label {
				cursor: pointer;
				font-weight: normal !important;
				margin: 0 !important;
				color: #333;
				user-select: none;
				font-size: 13px;
			}
			
			.selected-count {
				font-size: 12px;
				color: #666;
				margin-top: 8px;
				padding: 5px 10px;
				background: #f8f9fa;
				border-radius: 4px;
				text-align: center;
				font-weight: bold;
			}
			
			.chart-container {
				background: white;
				padding: 25px;
				border-radius: 8px;
				margin-bottom: 30px;
				box-shadow: 0 4px 12px rgba(0,0,0,0.1);
				border: 1px solid #e9ecef;
			}
			
			.stats-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
				gap: 20px;
				margin-bottom: 30px;
			}
			
			.stat-card {
				background: white;
				padding: 25px;
				border-radius: 8px;
				text-align: center;
				box-shadow: 0 4px 12px rgba(0,0,0,0.1);
				border: 1px solid #e9ecef;
				transition: transform 0.2s ease;
			}
			
			.stat-card:hover {
				transform: translateY(-2px);
				box-shadow: 0 8px 20px rgba(0,0,0,0.15);
			}
			
			.stat-value {
				font-size: 28px;
				font-weight: bold;
				color: #007bff;
				margin-bottom: 8px;
			}
			
			.stat-label {
				color: #666;
				font-size: 14px;
				font-weight: 600;
			}
			
			.stat-delta {
				font-size: 12px;
				margin-top: 5px;
				color: #28a745;
				font-weight: 500;
			}
			
			.data-table {
				width: 100%;
				border-collapse: collapse;
				margin-top: 20px;
				background: white;
				border-radius: 8px;
				overflow: hidden;
				box-shadow: 0 4px 12px rgba(0,0,0,0.1);
				border: 1px solid #e9ecef;
			}
			
			.data-table th,
			.data-table td {
				padding: 15px 12px;
				text-align: left;
				border-bottom: 1px solid #e9ecef;
			}
			
			.data-table th {
				background: #f8f9fa;
				font-weight: bold;
				color: #333;
				font-size: 14px;
			}
			
			.data-table tr:hover {
				background: #f0f8ff;
			}
			
			.data-table tr:last-child td {
				border-bottom: none;
			}
			
			.loading {
				text-align: center;
				padding: 40px;
				color: #666;
				font-size: 16px;
			}
			
			.error {
				background: #f8d7da;
				color: #721c24;
				padding: 15px 20px;
				border-radius: 6px;
				margin: 20px 0;
				border: 1px solid #f5c6cb;
			}
			
			.success {
				background: #d4edda;
				color: #155724;
				padding: 15px 20px;
				border-radius: 6px;
				margin: 20px 0;
				border: 1px solid #c3e6cb;
			}
			
			#multiSelectContainer {
				visibility: hidden;
				position: absolute;
				top: -9999px;
			}
			
			.section-title {
				font-size: 20px;
				font-weight: bold;
				color: #333;
				margin-bottom: 20px;
				padding-bottom: 10px;
				border-bottom: 2px solid #e9ecef;
			}
			
			@media (max-width: 768px) {
				.controls-grid {
					grid-template-columns: 1fr;
					gap: 20px;
				}
				.stats-grid {
					grid-template-columns: 1fr 1fr;
				}
				.checkbox-grid {
					grid-template-columns: 1fr;
				}
				.control-group {
					min-height: auto;
				}
			}
		</style>
	</head>
	<body class="left-sidebar is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">

						<!-- Logo -->
							<h1 id="logo"><a href="index.html">ost personal blog</a></h1>
							<p>Blog for linking with external PCs</p>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a class="icon solid fa-cog" href="index.html"><span>git data management</span></a></li>
									<li><a class="icon solid fa-home" href="real-estate.html"><span>real estate</span></a></li>
									<li><a class="icon solid fa-chart-line" href="stock.html"><span>stock</span></a></li>
									<li><a class="icon solid fa-heart" href="marriage.html"><span>marriage</span></a></li>
								</ul>
							</nav>

					</div>
				</section>

			<!-- Main -->
			<section id="main">
				<div class="analysis-container">
					<h1>🏠 지역별 아파트 가격지수 연도별 상승률 분석</h1>
					<p style="text-align: center; color: #666; font-size: 16px;">부동산 시장 트렌드를 한눈에 확인하세요!</p>
					
					<!-- 컨트롤 영역 -->
					<div class="controls-section" id="analysisControls" style="display: none;">
						<div class="controls-header">
							<h3>📊 분석 설정</h3>
						</div>
						<div class="controls-grid">
							<div class="control-group">
								<label for="analysisMode">분석 모드:</label>
								<select id="analysisMode" onchange="toggleAnalysisMode()">
									<option value="single">단일 지역 분석</option>
									<option value="compare">지역 비교 분석</option>
								</select>
							</div>
							
							<div class="control-group" id="singleSelectContainer">
								<label for="regionSelect">지역 선택:</label>
								<select id="regionSelect">
									<option value="">지역을 선택하세요...</option>
								</select>
							</div>
							
							<div class="control-group" id="multiSelectContainer">
								<label for="regionCheckboxes">비교 지역 선택 (최대 5개):</label>
								<div id="regionCheckboxes" class="checkbox-grid">
									<!-- 체크박스들이 여기에 동적으로 추가됩니다 -->
								</div>
								<div class="selected-count" id="selectedCount">선택된 지역: 0개</div>
							</div>
							
							<div class="control-group">
								<button onclick="analyzeData()">🔍 분석 시작</button>
							</div>
						</div>
					</div>
					
					<!-- 로딩/에러 메시지 -->
					<div id="loadingMessage" class="loading" style="display: none;">
						📊 데이터를 분석 중입니다...
					</div>
					
					<div id="errorMessage" class="error" style="display: none;"></div>
					<div id="successMessage" class="success" style="display: none;"></div>
					
					<!-- 통계 정보 -->
					<div id="statsSection" style="display: none;">
						<h2 class="section-title">📈 주요 통계</h2>
						<div class="stats-grid" id="statsGrid"></div>
					</div>
					
					<!-- 차트 영역 -->
					<div id="chartSection" style="display: none;">
						<h2 class="section-title">📊 상승률 차트</h2>
						<div class="chart-container">
							<canvas id="mainChart"></canvas>
						</div>
					</div>
					
					<!-- 데이터 테이블 -->
					<div id="tableSection" style="display: none;">
						<h2 class="section-title">📋 상세 데이터</h2>
						<div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #e9ecef;">
							<table class="data-table" id="dataTable">
								<thead id="tableHead"></thead>
								<tbody id="tableBody"></tbody>
							</table>
						</div>
					</div>
				</div>
			</section>

			<!-- Footer -->
				<section id="footer">
					<div id="copyright" class="container">
						<ul class="links">
							<li>&copy; 아파트 가격지수 분석기. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>
				</section>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			
			<script>
				// 전역 변수
				let apartmentData = {};
				let regionsList = [];
				let currentChart = null;
				
				// 페이지 로드 시 자동으로 엑셀 파일 로드
				window.addEventListener('DOMContentLoaded', function() {
					loadExcelFileAutomatically();
				});
				
				// 자동으로 엑셀 파일 로드
				function loadExcelFileAutomatically() {
					fetch('(월) 지역별 매매지수_아파트.xlsx')
						.then(response => {
							if (!response.ok) {
								throw new Error('파일을 찾을 수 없습니다');
							}
							return response.arrayBuffer();
						})
						.then(data => {
							try {
								const workbook = XLSX.read(data, { type: 'array' });
								
								// 첫 번째 시트 사용
								const sheetName = workbook.SheetNames[0];
								const worksheet = workbook.Sheets[sheetName];
								
								// 시트를 JSON으로 변환
								const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
								
								// 데이터 처리
								processExcelData(jsonData);
								
								// 분석 컨트롤 표시
								document.getElementById('analysisControls').style.display = 'block';
								
							} catch (error) {
								console.error('엑셀 파일 처리 오류:', error);
								showMessage('error', '❌ 엑셀 파일을 처리할 수 없습니다. 파일 형식을 확인해주세요.');
							}
						})
						.catch(error => {
							console.error('파일 로드 오류:', error);
							showMessage('error', '❌ 엑셀 파일을 찾을 수 없습니다. "(월) 지역별 매매지수_아파트.xlsx" 파일이 같은 폴더에 있는지 확인해주세요.');
						});
				}
				
				// 엑셀 데이터 처리
				function processExcelData(jsonData) {
					// 첫 번째 행을 헤더로 사용
					const headers = jsonData[0];
					
					// 중복된 컬럼명 처리
					const seen = {};
					const uniqueHeaders = [];
					for (let header of headers) {
						if (seen[header]) {
							seen[header]++;
							uniqueHeaders.push(`${header}_${seen[header]}`);
						} else {
							seen[header] = 0;
							uniqueHeaders.push(header);
						}
					}
					
					// 데이터 부분만 추출 (3번째 행부터)
					const dataRows = jsonData.slice(2);
					
					// 지역별 데이터 정리
					apartmentData = {};
					regionsList = [];
					
					for (let row of dataRows) {
						if (!row[1] || row[1] === '') continue; // 지역 컬럼이 비어있으면 스킵
						
						const region = row[1];
						if (!regionsList.includes(region)) {
							regionsList.push(region);
						}
						
						// 날짜별 데이터 정리
						const monthlyData = {};
						
						for (let i = 3; i < uniqueHeaders.length; i++) { // 3번째 컬럼부터 날짜 데이터
							const header = uniqueHeaders[i];
							const yearMonth = extractYearMonthFromColumn(header);
							
							if (yearMonth && row[i] !== undefined && row[i] !== '') {
								const year = yearMonth.year;
								const month = yearMonth.month;
								const value = parseFloat(row[i]);
								
								if (!isNaN(value)) {
									if (!monthlyData[year]) {
										monthlyData[year] = {};
									}
									monthlyData[year][month] = value;
								}
							}
						}
						
						// 연도별 상승률 계산
						const yearlyGrowth = {};
						
						for (let year of Object.keys(monthlyData).sort()) {
							const yearData = monthlyData[year];
							if (Object.keys(yearData).length >= 2) {
								const months = Object.keys(yearData).map(Number).sort((a, b) => a - b);
								const minMonth = months[0];
								const maxMonth = months[months.length - 1];
								
								const startValue = yearData[minMonth];
								const endValue = yearData[maxMonth];
								
								if (startValue > 0) {
									const growthRate = ((endValue - startValue) / startValue) * 100;
									yearlyGrowth[year] = {
										growth_rate: Math.round(growthRate * 100) / 100,
										start_month: minMonth,
										end_month: maxMonth,
										start_value: Math.round(startValue * 10) / 10,
										end_value: Math.round(endValue * 10) / 10
									};
								}
							}
						}
						
						apartmentData[region] = yearlyGrowth;
					}
					
					// UI 초기화
					initializeUI();
				}
				
				// 컬럼명에서 연도와 월 추출
				function extractYearMonthFromColumn(colName) {
					if (typeof colName !== 'string' || !colName.includes('년') || !colName.includes('월')) {
						return null;
					}
					
					const match = colName.match(/(\d{4})년\s*(\d{1,2})월/);
					if (match) {
						return {
							year: parseInt(match[1]),
							month: parseInt(match[2])
						};
					}
					
					return null;
				}
				
				// UI 초기화
				function initializeUI() {
					const singleSelect = document.getElementById('regionSelect');
					const checkboxContainer = document.getElementById('regionCheckboxes');
					
					// 기존 옵션 제거
					singleSelect.innerHTML = '<option value="">지역을 선택하세요...</option>';
					checkboxContainer.innerHTML = '';
					
					// 지역 옵션 추가
					regionsList.forEach(region => {
						// 단일 선택
						const option = document.createElement('option');
						option.value = region;
						option.textContent = region;
						singleSelect.appendChild(option);
						
						// 체크박스 생성
						const checkboxItem = document.createElement('div');
						checkboxItem.className = 'checkbox-item';
						
						const checkbox = document.createElement('input');
						checkbox.type = 'checkbox';
						checkbox.id = `region_${region}`;
						checkbox.value = region;
						checkbox.addEventListener('change', updateSelectedCount);
						
						const label = document.createElement('label');
						label.htmlFor = `region_${region}`;
						label.textContent = region;
						
						checkboxItem.appendChild(checkbox);
						checkboxItem.appendChild(label);
						checkboxContainer.appendChild(checkboxItem);
					});
				}
				
				// 선택된 지역 수 업데이트
				function updateSelectedCount() {
					const checkboxes = document.querySelectorAll('#regionCheckboxes input[type="checkbox"]:checked');
					const count = checkboxes.length;
					const countElement = document.getElementById('selectedCount');
					countElement.textContent = `선택된 지역: ${count}개`;
					
					// 5개 이상 선택 시 경고 색상
					if (count > 5) {
						countElement.style.color = '#dc3545';
						countElement.textContent = `선택된 지역: ${count}개 (최대 5개까지 선택 가능)`;
					} else {
						countElement.style.color = '#666';
					}
				}
				
				// 분석 모드 전환
				function toggleAnalysisMode() {
					const mode = document.getElementById('analysisMode').value;
					const singleContainer = document.getElementById('singleSelectContainer');
					const multiContainer = document.getElementById('multiSelectContainer');
					
					if (mode === 'single') {
						singleContainer.style.visibility = 'visible';
						singleContainer.style.position = 'static';
						multiContainer.style.visibility = 'hidden';
						multiContainer.style.position = 'absolute';
						multiContainer.style.top = '-9999px';
					} else {
						singleContainer.style.visibility = 'hidden';
						singleContainer.style.position = 'absolute';
						singleContainer.style.top = '-9999px';
						multiContainer.style.visibility = 'visible';
						multiContainer.style.position = 'static';
					}
					
					// 기존 결과 초기화
					clearResults();
				}
				
				// 데이터 분석 실행
				function analyzeData() {
					const mode = document.getElementById('analysisMode').value;
					
					if (mode === 'single') {
						analyzeSingleRegion();
					} else {
						analyzeMultipleRegions();
					}
				}
				
				// 단일 지역 분석
				function analyzeSingleRegion() {
					const selectedRegion = document.getElementById('regionSelect').value;
					
					if (!selectedRegion) {
						showMessage('error', '지역을 선택해주세요.');
						return;
					}
					
					showLoading(true);
					
					setTimeout(() => {
						const regionData = apartmentData[selectedRegion];
						
						if (!regionData || Object.keys(regionData).length === 0) {
							showMessage('error', '선택한 지역의 데이터를 찾을 수 없습니다.');
							showLoading(false);
							return;
						}
						
						// 차트 생성
						createSingleRegionChart(selectedRegion, regionData);
						
						// 통계 정보 표시
						displayStats(selectedRegion, regionData);
						
						// 데이터 테이블 표시
						displayDataTable(selectedRegion, regionData);
						
						showLoading(false);
						showMessage('success', `${selectedRegion} 지역 분석이 완료되었습니다.`);
					}, 500);
				}
				
				// 다중 지역 분석
				function analyzeMultipleRegions() {
					const checkboxes = document.querySelectorAll('#regionCheckboxes input[type="checkbox"]:checked');
					const selectedRegions = Array.from(checkboxes).map(cb => cb.value);
					
					if (selectedRegions.length < 2) {
						showMessage('error', '비교를 위해 최소 2개 지역을 선택해주세요.');
						return;
					}
					
					if (selectedRegions.length > 5) {
						showMessage('error', '최대 5개 지역만 선택할 수 있습니다.');
						return;
					}
					
					showLoading(true);
					
					setTimeout(() => {
						const regionsData = {};
						selectedRegions.forEach(region => {
							if (apartmentData[region]) {
								regionsData[region] = apartmentData[region];
							}
						});
						
						if (Object.keys(regionsData).length === 0) {
							showMessage('error', '선택한 지역들의 데이터를 찾을 수 없습니다.');
							showLoading(false);
							return;
						}
						
						// 비교 차트 생성
						createComparisonChart(regionsData);
						
						// 비교 통계 표시
						displayComparisonStats(regionsData);
						
						// 비교 테이블 표시
						displayComparisonTable(regionsData);
						
						showLoading(false);
						showMessage('success', `${selectedRegions.length}개 지역 비교 분석이 완료되었습니다.`);
					}, 500);
				}
				
				// 단일 지역 차트 생성
				function createSingleRegionChart(region, data) {
					const ctx = document.getElementById('mainChart').getContext('2d');
					
					if (currentChart) {
						currentChart.destroy();
					}
					
					const years = Object.keys(data).map(Number).sort();
					const growthRates = years.map(year => data[year].growth_rate);
					
					const colors = growthRates.map(rate => rate >= 0 ? '#4ECDC4' : '#FF6B6B');
					
					currentChart = new Chart(ctx, {
						type: 'bar',
						data: {
							labels: years,
							datasets: [{
								label: '상승률 (%)',
								data: growthRates,
								backgroundColor: colors,
								borderColor: colors,
								borderWidth: 1
							}]
						},
						options: {
							responsive: true,
							plugins: {
								title: {
									display: true,
									text: `🏠 ${region} 지역 연도별 아파트 가격지수 상승률`,
									font: {
										size: 16,
										weight: 'bold'
									}
								},
								legend: {
									display: false
								}
							},
							scales: {
								y: {
									beginAtZero: true,
									title: {
										display: true,
										text: '상승률 (%)'
									},
									grid: {
										color: 'rgba(0,0,0,0.1)'
									}
								},
								x: {
									title: {
										display: true,
										text: '연도'
									}
								}
							},
							plugins: {
								tooltip: {
									callbacks: {
										label: function(context) {
											const year = context.label;
											const yearData = data[year];
											return [
												`상승률: ${context.parsed.y.toFixed(1)}%`,
												`기간: ${yearData.start_month}월 → ${yearData.end_month}월`,
												`지수: ${yearData.start_value} → ${yearData.end_value}`
											];
										}
									}
								}
							}
						}
					});
					
					document.getElementById('chartSection').style.display = 'block';
				}
				
				// 비교 차트 생성
				function createComparisonChart(regionsData) {
					const ctx = document.getElementById('mainChart').getContext('2d');
					
					if (currentChart) {
						currentChart.destroy();
					}
					
					// 모든 연도 수집
					const allYears = new Set();
					Object.values(regionsData).forEach(data => {
						Object.keys(data).forEach(year => allYears.add(Number(year)));
					});
					const sortedYears = Array.from(allYears).sort();
					
					// 색상 팔레트
					const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'];
					
					// 데이터셋 생성
					const datasets = Object.keys(regionsData).map((region, index) => {
						const data = sortedYears.map(year => {
							return regionsData[region][year] ? regionsData[region][year].growth_rate : null;
						});
						
						return {
							label: region,
							data: data,
							borderColor: colors[index % colors.length],
							backgroundColor: colors[index % colors.length] + '20',
							fill: false,
							tension: 0.1,
							pointRadius: 4,
							pointHoverRadius: 6
						};
					});
					
					currentChart = new Chart(ctx, {
						type: 'line',
						data: {
							labels: sortedYears,
							datasets: datasets
						},
						options: {
							responsive: true,
							plugins: {
								title: {
									display: true,
									text: '🏠 지역별 아파트 가격지수 연도별 상승률 비교',
									font: {
										size: 16,
										weight: 'bold'
									}
								}
							},
							scales: {
								y: {
									beginAtZero: true,
									title: {
										display: true,
										text: '상승률 (%)'
									},
									grid: {
										color: 'rgba(0,0,0,0.1)'
									}
								},
								x: {
									title: {
										display: true,
										text: '연도'
									}
								}
							}
						}
					});
					
					document.getElementById('chartSection').style.display = 'block';
				}
				
				// 통계 정보 표시
				function displayStats(region, data) {
					const growthRates = Object.values(data).map(d => d.growth_rate);
					const avgRate = growthRates.reduce((a, b) => a + b, 0) / growthRates.length;
					const maxRate = Math.max(...growthRates);
					const minRate = Math.min(...growthRates);
					
					const maxYear = Object.keys(data).find(year => data[year].growth_rate === maxRate);
					const minYear = Object.keys(data).find(year => data[year].growth_rate === minRate);
					
					const statsHTML = `
						<div class="stat-card">
							<div class="stat-value">${avgRate.toFixed(2)}%</div>
							<div class="stat-label">평균 상승률</div>
							<div class="stat-delta">${avgRate > 0 ? '상승' : '하락'}</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${maxRate.toFixed(2)}%</div>
							<div class="stat-label">최대 상승률</div>
							<div class="stat-delta">${maxYear}년</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${minRate.toFixed(2)}%</div>
							<div class="stat-label">최소 상승률</div>
							<div class="stat-delta">${minYear}년</div>
						</div>
						<div class="stat-card">
							<div class="stat-value">${Object.keys(data).length}</div>
							<div class="stat-label">분석 연도 수</div>
							<div class="stat-delta">년</div>
						</div>
					`;
					
					document.getElementById('statsGrid').innerHTML = statsHTML;
					document.getElementById('statsSection').style.display = 'block';
				}
				
				// 비교 통계 표시
				function displayComparisonStats(regionsData) {
					const statsHTML = Object.keys(regionsData).map(region => {
						const data = regionsData[region];
						const growthRates = Object.values(data).map(d => d.growth_rate);
						const avgRate = growthRates.reduce((a, b) => a + b, 0) / growthRates.length;
						
						return `
							<div class="stat-card">
								<div class="stat-value">${avgRate.toFixed(2)}%</div>
								<div class="stat-label">${region}</div>
								<div class="stat-delta">평균 상승률</div>
							</div>
						`;
					}).join('');
					
					document.getElementById('statsGrid').innerHTML = statsHTML;
					document.getElementById('statsSection').style.display = 'block';
				}
				
				// 데이터 테이블 표시
				function displayDataTable(region, data) {
					const tableHead = document.getElementById('tableHead');
					const tableBody = document.getElementById('tableBody');
					
					// 테이블 헤더
					tableHead.innerHTML = `
						<tr>
							<th>연도</th>
							<th>시작월</th>
							<th>종료월</th>
							<th>시작값</th>
							<th>종료값</th>
							<th>상승률</th>
							<th>상승/하락</th>
						</tr>
					`;
					
					// 테이블 바디
					const sortedYears = Object.keys(data).sort();
					const tableRows = sortedYears.map(year => {
						const yearData = data[year];
						const isIncrease = yearData.growth_rate > 0;
						
						return `
							<tr>
								<td>${year}</td>
								<td>${yearData.start_month}월</td>
								<td>${yearData.end_month}월</td>
								<td>${yearData.start_value}</td>
								<td>${yearData.end_value}</td>
								<td>${yearData.growth_rate.toFixed(2)}%</td>
								<td>${isIncrease ? '📈 상승' : '📉 하락'}</td>
							</tr>
						`;
					}).join('');
					
					tableBody.innerHTML = tableRows;
					document.getElementById('tableSection').style.display = 'block';
				}
				
				// 비교 테이블 표시
				function displayComparisonTable(regionsData) {
					const tableHead = document.getElementById('tableHead');
					const tableBody = document.getElementById('tableBody');
					
					// 테이블 헤더
					tableHead.innerHTML = `
						<tr>
							<th>지역</th>
							<th>평균 상승률</th>
							<th>최대 상승률</th>
							<th>최소 상승률</th>
							<th>분석 연도</th>
						</tr>
					`;
					
					// 테이블 바디
					const tableRows = Object.keys(regionsData).map(region => {
						const data = regionsData[region];
						const growthRates = Object.values(data).map(d => d.growth_rate);
						const avgRate = growthRates.reduce((a, b) => a + b, 0) / growthRates.length;
						const maxRate = Math.max(...growthRates);
						const minRate = Math.min(...growthRates);
						
						return `
							<tr>
								<td>${region}</td>
								<td>${avgRate.toFixed(2)}%</td>
								<td>${maxRate.toFixed(2)}%</td>
								<td>${minRate.toFixed(2)}%</td>
								<td>${Object.keys(data).length}년</td>
							</tr>
						`;
					}).join('');
					
					tableBody.innerHTML = tableRows;
					document.getElementById('tableSection').style.display = 'block';
				}
				
				// 유틸리티 함수들
				function showLoading(show) {
					document.getElementById('loadingMessage').style.display = show ? 'block' : 'none';
				}
				
				function showMessage(type, message) {
					const errorEl = document.getElementById('errorMessage');
					const successEl = document.getElementById('successMessage');
					
					errorEl.style.display = 'none';
					successEl.style.display = 'none';
					
					if (type === 'error') {
						errorEl.textContent = message;
						errorEl.style.display = 'block';
						setTimeout(() => errorEl.style.display = 'none', 5000);
					} else if (type === 'success') {
						successEl.textContent = message;
						successEl.style.display = 'block';
						setTimeout(() => successEl.style.display = 'none', 3000);
					}
				}
				
				function clearResults() {
					document.getElementById('statsSection').style.display = 'none';
					document.getElementById('chartSection').style.display = 'none';
					document.getElementById('tableSection').style.display = 'none';
					
					if (currentChart) {
						currentChart.destroy();
						currentChart = null;
					}
				}
			</script>

	</body>
</html>
